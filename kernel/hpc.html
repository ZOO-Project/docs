

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Optional HPC support &mdash; ZOO-Project 1.8 documentation</title>
  
  <link href="https://fonts.googleapis.com/css?family=Days+One" rel="stylesheet" type="text/css">
  
  

  

  
  
    
      <link rel="search" type="application/opensearchdescription+xml" title="Search within ZOO-Project 1.8 documentation" href="../_static/opensearch.xml"/>
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="ZOO-Project 1.8 documentation" href="../index.html"/>
        <link rel="up" title="ZOO-Kernel" href="index.html"/>
        <link rel="next" title="ZOO-Services" href="../services/index.html"/>
        <link rel="prev" title="Optional SAGA GIS support" href="sagagis.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
	  <a class="shrink" href="http://zoo-project.org"><img src="/docs/_static/zoo-sun-logo.png" class="img-responsive sun" style="display: inline;"> ZOO</a>
        

        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro.html#what-is-zoo-project">What is ZOO-Project ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro.html#zoo-project-components">ZOO-Project components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro.html#open-source">Open Source</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../install/index.html">ZOO-Project installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../install/prerequisites.html">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/download.html">Download</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/installation.html">Installation on Unix/Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/debian.html">Installation on Debian / Ubuntu</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/opensuse.html">Install on OpenSUSE</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/centos.html">Installation on CentOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/windows.html">Installation on Windows ™</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">ZOO-Kernel</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="what.html">What is ZOO-Kernel ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html">ZOO-Kernel configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="mapserver.html">Optional MapServer support</a></li>
<li class="toctree-l2"><a class="reference internal" href="orfeotoolbox.html">Optional Orfeo Toolbox support</a></li>
<li class="toctree-l2"><a class="reference internal" href="sagagis.html">Optional SAGA GIS support</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Optional HPC support</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../services/index.html">ZOO-Services</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../services/what.html">What are ZOO-Services ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../services/zcfg-reference.html">ZOO-Service configuration file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../services/process-profiles.html">Process profiles registry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../services/howtos.html">Create your own ZOO-Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../services/translation.html">Translation Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../services/status.html">ZOO Status Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../services/debug.html">Debugging ZOO Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../services/zoo-services.html">Available ZOO-Services</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">ZOO-API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/what.html">What is ZOO-API ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/howto.html">Using ZOO-API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/classes.html">ZOO-API Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/examples.html">Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../client/index.html">ZOO-Client</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../client/what.html">What is ZOO-Client ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../client/howto.html">Using ZOO-Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../client/example.html">Example application</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../contribute/index.html">Contributor Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../contribute/howto.html">How to contribute ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribute/code.html">Contribute code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribute/doc.html">Contribute documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribute/dev.html">Committer guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribute/release.html">Release Procedure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribute/translate.html">Contribute translation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribute/contributors.html">List of contributors</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">ZOO-Project</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html"> Documentation</a> &#8725; &#160;</li>
      
          <li><a href="index.html">ZOO-Kernel</a> &#8725; &#160;</li>
      
    <li>Optional HPC support</li>
      <li class="wy-breadcrumbs-aside">
       $Date$
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <section id="optional-hpc-support">
<span id="kernel-hpc"></span><h1>Optional HPC support<a class="headerlink" href="#optional-hpc-support" title="Permalink to this headline">¶</a></h1>
<p>The optional ZOO-Kernel HPC support gives you the opportunity to use
OGC WPS for invoking remote execution of OTB applications. The current
implementation rely on <a class="reference external" href="https://www.openssh.com/">OpenSSH</a> and the
<a class="reference external" href="http://slurm.schedmd.com/">Slurm</a>  scheduler.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="https://slurm.schedmd.com/slurm_logo.png"><img alt="Slurm logo" src="https://slurm.schedmd.com/slurm_logo.png" style="width: 45.0px; height: 45.0px;" /></a> <a class="reference external" href="http://slurm.schedmd.com/">Slurm</a> is an acronym for Simple Linux Utility for Resource Management. Learn more on official <a class="reference external" href="https://slurm.schedmd.com/overview.html">website</a>.</p>
</div>
<p>For executing an OGC WPS Service using this HPC support, one should
use the OGC WPS version 2.0.0 and asynchornous request. Any tentative
to execute synchronously a HPC service will fail with the message “The
synchronous mode is not supported by this type of service”. The
ZOO-Kernel is not the only responsible for the execution and will wait
for the execution on the HPC server to end before being able to
continue its execution. Also, transfering the data from the WPS server
to the cluster and downloading the data produced by the execution will
take time. Hence, when OGC WPS Client will request for GetCapabilities
or DescribeProcess only the “async-execute” mode will be present in
the jobControlOptions attribute for the HPC services.</p>
<p>You can see in the sequence diagram below the interactions between
the OGC WPS Server (ZOO-Kernel), the mail daemon (running on the OGC
WPS server), the Callback Service and, the HPC Server during an
execution of a HPC Service. The dashed lines represent the behavior in
case the optional callback service invocation has been activated. These
invocations are made asynchronously for lowering their impact over the
whole process in case of failure of the callback service for instance.</p>
<p>By now, the callback service is not a WPS service but an independent server.</p>
<p><a class="reference internal" href="../_images/hpc_schema.svg"><img alt="HPC Support schema" height="1103" src="../_images/hpc_schema.svg" width="528" /></a></p>
<section id="installation-and-configuration">
<h2>Installation and configuration<a class="headerlink" href="#installation-and-configuration" title="Permalink to this headline">¶</a></h2>
<p>Follow the step described below in order to activate the ZOO-Project optional HPC support.</p>
<section id="prerequisites">
<h3>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>latest <a class="reference external" href="http://zoo-project.org/trac/browser/trunk/zoo-project/zoo-kernel">ZOO-Kernel</a>
trunk version</p></li>
<li><p><a class="reference external" href="https://www.libssh2.org/">libssh2</a></p></li>
<li><p><a class="reference external" href="http://www.mapserver.org">MapServer</a></p></li>
<li><p>an access to a server with <a class="reference external" href="http://slurm.schedmd.com">Slurm</a>
and <a class="reference external" href="https://www.orfeo-toolbox.org">OrfeoToolBox</a>.</p></li>
</ul>
</div></blockquote>
</section>
<section id="installation-steps">
<h3>Installation steps<a class="headerlink" href="#installation-steps" title="Permalink to this headline">¶</a></h3>
<section id="id3">
<h4>ZOO-Kernel<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<p>Compile ZOO-Kernel using the configuration options as shown below:</p>
<div class="highlight-guess notranslate"><div class="highlight"><pre><span></span>cd zoo-kernel
autoconf
./configure  --with-hpc=yes --with-ssh2=/usr --with-mapserver=/usr --with-ms-version=7
make
sudo make install
</pre></div>
</div>
<p>Optionally, you can ask your ZOO-Kernel to invoke a callback service
which is responsible to record execution history and data
produced. In such a case you can add the <code class="docutils literal notranslate"><span class="pre">--with-callback=yes</span></code>
option to the configure command.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In case you need other languages to be activated, such as Python
for exemple, please use the corresponding option(s).</p>
</div>
</section>
<section id="finalizehpc-wps-service">
<h4>FinalizeHPC WPS Service<a class="headerlink" href="#finalizehpc-wps-service" title="Permalink to this headline">¶</a></h4>
<p>For being informed that the remote OTB application ends on the
cluster, one should invoke the FinalizeHPC service. It is responsible
to connect using SSH to the HPC server to run an <code class="docutils literal notranslate"><span class="pre">sacct</span></code> command for
extracting detailled informations about the sbatch that has been
run. If the <code class="docutils literal notranslate"><span class="pre">sacct</span></code> command succeed, and the service is no more
running on the cluster, then the informations are stored in a local
conf file containing a <code class="docutils literal notranslate"><span class="pre">[henv]</span></code> section definition, the service
connect to unix domain socket (opened by the ZOO-Kernel that has
initially schedduled the service through Slurm) to inform about the
end of the service run on the cluster. This makes the initial
ZOO-Kernel to continue its execution by downloading output data
produced over the execution of the OTB application on the cluster. So,
this service should be build and deployed on your WPS server. You can
use the following commands to do so.</p>
<div class="highlight-guess notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span><span class="w"> </span><span class="n">zoo</span><span class="o">-</span><span class="n">service</span><span class="o">/</span><span class="n">utils</span><span class="o">/</span><span class="n">hpc</span><span class="w"></span>
<span class="n">make</span><span class="w"></span>
<span class="n">cp</span><span class="w"> </span><span class="n">cgi</span><span class="o">-</span><span class="n">env</span><span class="o">/*</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">cgi</span><span class="o">-</span><span class="n">bin</span><span class="w"></span>
<span class="n">mkdir</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">xslt</span><span class="o">/</span><span class="w"></span>
<span class="n">cp</span><span class="w"> </span><span class="n">xslt</span><span class="o">/</span><span class="n">updateExecute</span><span class="o">.</span><span class="n">xsl</span><span class="w"> </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">xslt</span><span class="o">/</span><span class="w"></span>
</pre></div>
</div>
<p>You should also copy the
.. note:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FinalizeHPC</span> <span class="n">should</span> <span class="n">be</span> <span class="n">called</span> <span class="kn">from</span> <span class="nn">a</span> <span class="n">daemon</span><span class="p">,</span> <span class="n">responsible</span> <span class="k">for</span> <span class="n">reading</span>
<span class="n">mails</span> <span class="n">sent</span> <span class="n">by</span> <span class="n">the</span> <span class="n">cluster</span> <span class="n">to</span> <span class="n">the</span> <span class="n">WPS</span> <span class="n">server</span><span class="o">.</span>
</pre></div>
</div>
</section>
</section>
<section id="configuration-steps">
<h3>Configuration steps<a class="headerlink" href="#configuration-steps" title="Permalink to this headline">¶</a></h3>
<section id="main-configuration-file">
<h4>Main configuration file<a class="headerlink" href="#main-configuration-file" title="Permalink to this headline">¶</a></h4>
<p>When HPC support is activated, you can use different HPC configuration
by adding <code class="docutils literal notranslate"><span class="pre">confId</span></code> to your usual <code class="docutils literal notranslate"><span class="pre">serviceType=HPC</span></code> in your zcfg
file. For being able to find which configuration a service should
use, the ZOO-Kernel require to know what are the options for creating
the relevant sbatch.</p>
<p>Also, you can define multiple configuration to run the OTB application
on the cluster(s) depending on the size of the inputs. You should
define in the section corresponding to your <code class="docutils literal notranslate"><span class="pre">ServiceType</span></code> the
treshold for both raster (<code class="docutils literal notranslate"><span class="pre">preview_max_pixels</span></code>) and vector
(<code class="docutils literal notranslate"><span class="pre">preview_max_features</span></code>) input. In case the raster or the vector
dataset is upper the defined limit, then the <code class="docutils literal notranslate"><span class="pre">fullres_conf</span></code> will
be used, in other case the <code class="docutils literal notranslate"><span class="pre">preview_conf</span></code> will be.</p>
<p>For each of this configurations, you will have define the parameters
to connect the HPC server, by providing <code class="docutils literal notranslate"><span class="pre">ssh_host</span></code>, <code class="docutils literal notranslate"><span class="pre">ssh_port</span></code>,
<code class="docutils literal notranslate"><span class="pre">ssh_user</span></code> and, <code class="docutils literal notranslate"><span class="pre">ssh_key</span></code>. Also, you should set where the input
data will be stored on the HPC server, by defining
<code class="docutils literal notranslate"><span class="pre">remote_data_path</span></code> (the default directory to store data),
<code class="docutils literal notranslate"><span class="pre">remote_presistent_data_path</span></code> (the directory to store data
considerated as shared data, see below)  and, <code class="docutils literal notranslate"><span class="pre">remote_work_path</span></code> the
directory used to store the SBATCH script created locally then,
uploaded by the ZOO-Kernel.</p>
<p>Also, there are multiple options you can use to run your applications
using  SBATCH. You can define them using <code class="docutils literal notranslate"><span class="pre">jobscript_header</span></code>,
<code class="docutils literal notranslate"><span class="pre">jobscript_body</span></code> and <code class="docutils literal notranslate"><span class="pre">jobscript_footer</span></code> or by using
<code class="docutils literal notranslate"><span class="pre">sbatch_options_&lt;SBATCH_OPTION&gt;</span></code> where <code class="docutils literal notranslate"><span class="pre">&lt;SBATCH_OPTION&gt;</span></code> should be
replaced by a real option name, like <code class="docutils literal notranslate"><span class="pre">workdir</span></code> in the following
example. For creating the SBATCH file, the ZOO-Kernel create a file
starting with the content of the file pointed by <code class="docutils literal notranslate"><span class="pre">jobscript_header</span></code>
(if any, a default header is set in other case), then, any option
defined in <code class="docutils literal notranslate"><span class="pre">sbatch_options_*</span></code> and a specific one: <code class="docutils literal notranslate"><span class="pre">job-name</span></code>,
then, <code class="docutils literal notranslate"><span class="pre">jobscript_body</span></code> is added (if any, usually to load required
modules), then the ZOO-Kernel add the invocation of the OTB
application then, optionally the <code class="docutils literal notranslate"><span class="pre">jobscript_footer</span></code> is added, if
any.</p>
<p>Finally, <code class="docutils literal notranslate"><span class="pre">remote_command_opt</span></code> should contains all the informations
you want to be extracted by the <code class="docutils literal notranslate"><span class="pre">sacct</span></code> command run by the
FinalizeHPC service. <code class="docutils literal notranslate"><span class="pre">billing_nb_cpu</span></code> is used for billing purpose to
define a cost for using a specific option (preview or fullres).</p>
<p>In addition to the specific <code class="docutils literal notranslate"><span class="pre">HPC_&lt;ID&gt;</span></code> section and the corresponding
fullres and preview ones, you should define in the <code class="docutils literal notranslate"><span class="pre">[security]</span></code>
section using the <code class="docutils literal notranslate"><span class="pre">shared</span></code> parameter to set the URLs from where the
downloaded data should be considerated as shared, meaning that even if
this ressources requires authentication to be accessed, any
authenticated user will be allowed to access the cache file even if
it was created by somebody else. Also, this shared cache won’t contain
any authentication informations in the cache file name as it is
usually the case.</p>
<div class="highlight-guess notranslate"><div class="highlight"><pre><span></span><span class="k">[HPC_Sample]</span><span class="w"></span>
<span class="na">preview_max_pixels</span><span class="o">=</span><span class="s">820800</span><span class="w"></span>
<span class="na">preview_max_features</span><span class="o">=</span><span class="s">100000</span><span class="w"></span>
<span class="na">preview_conf</span><span class="o">=</span><span class="s">hpc-config-2</span><span class="w"></span>
<span class="na">fullres_conf</span><span class="o">=</span><span class="s">hpc-config-1</span><span class="w"></span>

<span class="k">[hpc-config-1]</span><span class="w"></span>
<span class="na">ssh_host</span><span class="o">=</span><span class="s">mycluster.org</span><span class="w"></span>
<span class="na">ssh_port</span><span class="o">=</span><span class="s">22</span><span class="w"></span>
<span class="na">ssh_user</span><span class="o">=</span><span class="s">cUser</span><span class="w"></span>
<span class="na">ssh_key</span><span class="o">=</span><span class="s">/var/www/.ssh/id_rsa.pub</span><span class="w"></span>
<span class="na">remote_data_path</span><span class="o">=</span><span class="s">/home/cUser/wps_executions/data</span><span class="w"></span>
<span class="na">remote_persitent_data_path</span><span class="o">=</span><span class="s">/home/cUser/wps_executions/datap</span><span class="w"></span>
<span class="na">remote_work_path</span><span class="o">=</span><span class="s">/home/cUser/wps_executions/script</span><span class="w"></span>
<span class="na">jobscript_header</span><span class="o">=</span><span class="s">/usr/lib/cgi-bin/config-hpc1_header.txt</span><span class="w"></span>
<span class="na">jobscript_body</span><span class="o">=</span><span class="s">/usr/lib/cgi-bin/config-hpc1_body.txt</span><span class="w"></span>
<span class="na">sbatch_options_workdir</span><span class="o">=</span><span class="s">/home/cUser/wps_executions/script</span><span class="w"></span>
<span class="na">sbatch_substr</span><span class="o">=</span><span class="s">Submitted batch job</span><span class="w"></span>
<span class="na">billing_nb_cpu</span><span class="o">=</span><span class="s">1</span><span class="w"></span>
<span class="na">remote_command_opt</span><span class="o">=</span><span class="s">AllocCPUS,AllocGRES,AllocNodes,AllocTRES,Account,AssocID,AveCPU,AveCPUFreq,AveDiskRead,AveDiskWrite,AvePages,AveRSS,AveVMSize,BlockID,Cluster,Comment,ConsumedEnergy,ConsumedEnergyRaw,CPUTime,CPUTimeRAW,DerivedExitCode,Elapsed,Eligible,End,ExitCode,GID,Group,JobID,JobIDRaw,JobName,Layout,MaxDiskRead,MaxDiskReadNode,MaxDiskReadTask,MaxDiskWrite,MaxDiskWriteNode,MaxDiskWriteTask,MaxPages,MaxPagesNode,MaxPagesTask,MaxRSS,MaxRSSNode,MaxRSSTask,MaxVMSize,MaxVMSizeNode,MaxVMSizeTask,MinCPU,MinCPUNode,MinCPUTask,NCPUS,NNodes,NodeList,NTasks,Priority,Partition,QOS,QOSRAW,ReqCPUFreq,ReqCPUFreqMin,ReqCPUFreqMax,ReqCPUFreqGov,ReqCPUS,ReqGRES,ReqMem,ReqNodes,ReqTRES,Reservation,ReservationId,Reserved,ResvCPU,ResvCPURAW,Start,State,Submit,Suspended,SystemCPU,Timelimit,TotalCPU,UID,User,UserCPU,WCKey,WCKeyID</span><span class="w"></span>

<span class="k">[hpc-config-2]</span><span class="w"></span>
<span class="na">ssh_host</span><span class="o">=</span><span class="s">mycluster.org</span><span class="w"></span>
<span class="na">ssh_port</span><span class="o">=</span><span class="s">22</span><span class="w"></span>
<span class="na">ssh_user</span><span class="o">=</span><span class="s">cUser</span><span class="w"></span>
<span class="na">ssh_key</span><span class="o">=</span><span class="s">/var/www/.ssh/id_rsa.pub</span><span class="w"></span>
<span class="na">remote_data_path</span><span class="o">=</span><span class="s">/home/cUser/wps_executions/data</span><span class="w"></span>
<span class="na">remote_persitent_data_path</span><span class="o">=</span><span class="s">/home/cUser/wps_executions/datap</span><span class="w"></span>
<span class="na">remote_work_path</span><span class="o">=</span><span class="s">/home/cUser/wps_executions/script</span><span class="w"></span>
<span class="na">jobscript_header</span><span class="o">=</span><span class="s">/usr/lib/cgi-bin/config-hpc2_header.txt</span><span class="w"></span>
<span class="na">jobscript_body</span><span class="o">=</span><span class="s">/usr/lib/cgi-bin/config-hpc2_body.txt</span><span class="w"></span>
<span class="na">sbatch_options_workdir</span><span class="o">=</span><span class="s">/home/cUser/wps_executions/script</span><span class="w"></span>
<span class="na">sbatch_substr</span><span class="o">=</span><span class="s">Submitted batch job</span><span class="w"></span>
<span class="na">billing_nb_cpu</span><span class="o">=</span><span class="s">4</span><span class="w"></span>
<span class="na">remote_command_opt</span><span class="o">=</span><span class="s">AllocCPUS,AllocGRES,AllocNodes,AllocTRES,Account,AssocID,AveCPU,AveCPUFreq,AveDiskRead,AveDiskWrite,AvePages,AveRSS,AveVMSize,BlockID,Cluster,Comment,ConsumedEnergy,ConsumedEnergyRaw,CPUTime,CPUTimeRAW,DerivedExitCode,Elapsed,Eligible,End,ExitCode,GID,Group,JobID,JobIDRaw,JobName,Layout,MaxDiskRead,MaxDiskReadNode,MaxDiskReadTask,MaxDiskWrite,MaxDiskWriteNode,MaxDiskWriteTask,MaxPages,MaxPagesNode,MaxPagesTask,MaxRSS,MaxRSSNode,MaxRSSTask,MaxVMSize,MaxVMSizeNode,MaxVMSizeTask,MinCPU,MinCPUNode,MinCPUTask,NCPUS,NNodes,NodeList,NTasks,Priority,Partition,QOS,QOSRAW,ReqCPUFreq,ReqCPUFreqMin,ReqCPUFreqMax,ReqCPUFreqGov,ReqCPUS,ReqGRES,ReqMem,ReqNodes,ReqTRES,Reservation,ReservationId,Reserved,ResvCPU,ResvCPURAW,Start,State,Submit,Suspended,SystemCPU,Timelimit,TotalCPU,UID,User,UserCPU,WCKey,WCKeyID</span><span class="w"></span>

<span class="k">[security]</span><span class="w"></span>
<span class="na">attributes</span><span class="o">=</span><span class="s">Cookie,Cookies</span><span class="w"></span>
<span class="na">hosts</span><span class="o">=</span><span class="s">*</span><span class="w"></span>
<span class="na">shared</span><span class="o">=</span><span class="s">myhost.net/WCS</span><span class="w"></span>
</pre></div>
</div>
<p>You can see below an example of <code class="docutils literal notranslate"><span class="pre">jobscript_header</span></code> file.</p>
<div class="highlight-guess notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
<span class="c1">#SBATCH --ntasks=1</span>
<span class="c1">#SBATCH --ntasks-per-node=1</span>
<span class="c1">#SBATCH --exclusive</span>
<span class="c1">#SBATCH --distribution=block:block</span>
<span class="c1">#SBATCH --partition=partName</span>
<span class="c1">#SBATCH --mail-type=END              # Mail events (NONE, BEGIN, END, FAIL, ALL)</span>
<span class="c1">#SBATCH --mail-user=user@wps_server.net   # Where to send mail</span>
</pre></div>
</div>
<p>You can see below an example of <code class="docutils literal notranslate"><span class="pre">jobscript_body</span></code> file.</p>
<div class="highlight-guess notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load all the modules</span><span class="w"></span>
<span class="n">module</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="n">cv</span><span class="o">-</span><span class="n">standard</span><span class="w"></span>
<span class="n">module</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="n">cmake</span><span class="o">/</span><span class="mf">3.6</span><span class="o">.</span><span class="mi">0</span><span class="w"></span>
<span class="n">module</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="n">gcc</span><span class="o">/</span><span class="mf">4.9</span><span class="o">.</span><span class="mi">3</span><span class="w"></span>
<span class="n">module</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="n">use</span><span class="o">.</span><span class="n">own</span><span class="w"></span>
<span class="n">module</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="n">OTB</span><span class="o">/</span><span class="mf">6.1</span><span class="o">-</span><span class="n">serial</span><span class="o">-</span><span class="mi">24</span><span class="n">threads</span><span class="w"></span>
</pre></div>
</div>
<p>In casse you have activated the callback service, then you should also
have a <code class="docutils literal notranslate"><span class="pre">[callback]</span></code> section, in which you will define <code class="docutils literal notranslate"><span class="pre">url</span></code> to
invoke the callback service, <code class="docutils literal notranslate"><span class="pre">prohibited</span></code> to list the services that
should not require invocation of the callback sercvice if any and,
<code class="docutils literal notranslate"><span class="pre">template</span></code> pointing to the local <code class="docutils literal notranslate"><span class="pre">updateExecute.xsl</span></code> file used to
replace any inputs provided by value to the reference to the locally
published OGC WFS/WCS web services. This execute request is provided
to the callback service.</p>
<div class="highlight-guess notranslate"><div class="highlight"><pre><span></span><span class="k">[callback]</span><span class="w"></span>
<span class="na">url</span><span class="o">=</span><span class="s">http://myhost.net:port/callbackUpdate/</span><span class="w"></span>
<span class="na">prohibited</span><span class="o">=</span><span class="s">FinalizeHPC,Xml2Pdf,DeleteData</span><span class="w"></span>
<span class="na">template</span><span class="o">=</span><span class="s">/home/cUser/wps_dir/updateExecute.xsl</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="ogc-wps-services-metadata">
<h4>OGC WPS Services metadata<a class="headerlink" href="#ogc-wps-services-metadata" title="Permalink to this headline">¶</a></h4>
<p>To produce the zcfg files corresponding to the metadata definition of
the WPS services, you can use the otb2zcfg tool to produce them. You
will need to replace <code class="docutils literal notranslate"><span class="pre">serviceType=OTB</span></code> by <code class="docutils literal notranslate"><span class="pre">serviceType=HPC</span></code> and,
optionally, add one line containing <code class="docutils literal notranslate"><span class="pre">confId=HPC_Sample</span></code> for
instance.</p>
<p>Please refer to <a class="reference external" href="./orfeotoolbox.html#services-configuration-file">otb2zcfg</a> documentation to
know how to use this tool.</p>
<p>Using the HPC support, when you define one output, there will be
automatically 1 to 3 inner outputs created for the defined output:</p>
<dl class="simple">
<dt>download_link</dt><dd><p>URL to download to generated output</p>
</dd>
<dt>wms_link</dt><dd><p>URL to access the OGC WMS for this output (only in case
<cite>useMapserver=true</cite>)</p>
</dd>
<dt>wcs_link/wfs_link</dt><dd><p>URL to access the OGC WCS or WFS for this output (only in case
<cite>useMapserver=true</cite>)</p>
</dd>
</dl>
<p>You can see below an example of Output node resulting of the
definition of one output named out and typed as geographic imagery.</p>
<div class="highlight-guess notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;wps:Output&gt;</span>
  <span class="nt">&lt;ows:Title&gt;</span>Outputed Image<span class="nt">&lt;/ows:Title&gt;</span>
  <span class="nt">&lt;ows:Abstract&gt;</span>Image produced by the application<span class="nt">&lt;/ows:Abstract&gt;</span>
  <span class="nt">&lt;ows:Identifier&gt;</span>out<span class="nt">&lt;/ows:Identifier&gt;</span>
  <span class="nt">&lt;wps:Output&gt;</span>
    <span class="nt">&lt;ows:Title&gt;</span>Download link<span class="nt">&lt;/ows:Title&gt;</span>
    <span class="nt">&lt;ows:Abstract&gt;</span>The download link<span class="nt">&lt;/ows:Abstract&gt;</span>
    <span class="nt">&lt;ows:Identifier&gt;</span>download_link<span class="nt">&lt;/ows:Identifier&gt;</span>
    <span class="nt">&lt;wps:ComplexData&gt;</span>
      <span class="nt">&lt;wps:Format</span> <span class="na">default=</span><span class="s">&quot;true&quot;</span> <span class="na">mimeType=</span><span class="s">&quot;image/tiff&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;wps:Format</span> <span class="na">mimeType=</span><span class="s">&quot;image/tiff&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/wps:ComplexData&gt;</span>
  <span class="nt">&lt;/wps:Output&gt;</span>
  <span class="nt">&lt;wps:Output&gt;</span>
    <span class="nt">&lt;ows:Title&gt;</span>WMS link<span class="nt">&lt;/ows:Title&gt;</span>
    <span class="nt">&lt;ows:Abstract&gt;</span>The WMS link<span class="nt">&lt;/ows:Abstract&gt;</span>
    <span class="nt">&lt;ows:Identifier&gt;</span>wms_link<span class="nt">&lt;/ows:Identifier&gt;</span>
    <span class="nt">&lt;wps:ComplexData&gt;</span>
      <span class="nt">&lt;wps:Format</span> <span class="na">default=</span><span class="s">&quot;true&quot;</span> <span class="na">mimeType=</span><span class="s">&quot;image/tiff&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;wps:Format</span> <span class="na">mimeType=</span><span class="s">&quot;image/tiff&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/wps:ComplexData&gt;</span>
  <span class="nt">&lt;/wps:Output&gt;</span>
  <span class="nt">&lt;wps:Output&gt;</span>
    <span class="nt">&lt;ows:Title&gt;</span>WCS link<span class="nt">&lt;/ows:Title&gt;</span>
    <span class="nt">&lt;ows:Abstract&gt;</span>The WCS link<span class="nt">&lt;/ows:Abstract&gt;</span>
    <span class="nt">&lt;ows:Identifier&gt;</span>wcs_link<span class="nt">&lt;/ows:Identifier&gt;</span>
    <span class="nt">&lt;wps:ComplexData&gt;</span>
      <span class="nt">&lt;wps:Format</span> <span class="na">default=</span><span class="s">&quot;true&quot;</span> <span class="na">mimeType=</span><span class="s">&quot;image/tiff&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;wps:Format</span> <span class="na">mimeType=</span><span class="s">&quot;image/tiff&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/wps:ComplexData&gt;</span>
  <span class="nt">&lt;/wps:Output&gt;</span>
<span class="nt">&lt;/wps:Output&gt;</span>
</pre></div>
</div>
</section>
</section>
</section>
</section>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../services/index.html" class="btn btn-neutral float-right" title="ZOO-Services">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="sagagis.html" class="btn btn-neutral" title="Optional SAGA GIS support"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>
  <div class="pfoot">
  <div role="contentinfo">
    <p>
        &copy; Copyright 2009-2021, ZOO-Project team.
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> inspired by <a href="https://readthedocs.org">Read the Docs</a>.
</div>
</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.8',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>